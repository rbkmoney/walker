# Walker
Сервис для работы с заявками.
 
# Аналитика 
## Участники
1. Merchant - заказчик , участник 
 * Создание заявки
 * Revoke заявки 
2. Manager - сотрудник компании
 * Создание, Изменение, Принятие, Отклонение заявки     
 * Создание и просмотр комментариев
 * Просмотр истории изменений заявки
 
## Жизненный цикл заявки
 1. Заявка создается пользователем или менеджером, попадает в HellGate  
 2. event попадает в Bustermaze
 3. Walker опрашивает Bustermaze создает сохраняет заявку
 4. Manager просматривает актуальные заявки на UI и принимает решение по заявке (отклонить или принять)
 5. Walker получает событие c подтверждением обновляет (закрывает) заявку.

## Workflow merchant
 1. Пользователь создает аккаунт и логинится.
    - создается аккаунт в Keycloak
    - заводится запись в HG с авто-принятой заявкой и тестовым магазином
 2. Пользователь создает заявку о создании магазина
    - создается заявка в HG на создание магазина с указанными данными 
 3. Manager - получает почтой документы от мерчанта. Добавляет в заявку:
    - данные о договоре (legal agreement)
    - категорию магазина
    - contract template     
 4. Manager принимает заявку 
 5. Пользователь видит рабочий тестовый магазин

 ## Комментарии
 Есть методы для добавления комментария к конкретной заявки от имени менеджера
 Сейчас Комментарии могут оставлять и просматривать могут только пользователи PAPI.
 По сути это записи привязаннее к ClaimId + PartyId. 
 
 ## История
 Есть история изменений Claim-а - (Actions). Они привязаные к ClaimId + PartyId и ведут историю изменений статуса, 
 обновлений комментариев и т.д.
 Есть методы для просмотра истории изменения текущего claim-a
      
 
# Development 
Все данные по claim-am хранятся в базе данных в виде
    - partyId   
    - версия дамзели
    - assigned user (пока не используется)
    - сконвертированное в json представление modification unit-a
    - атрибуты заявки (дата, claimId ...)

При запросе на получение заявок json конвертируется в thrift.

    Thrift используется тот же что и в HG. Изменение структуры Claim в HG требует конвертации заявок в Walker
    Либо перезаливку claim-ов.
          
При получениия события об обновлении claim-a

# Roadmap

Предполагаемый процесс регистрации пользователя с Лендинга
1. Мерчант попадет на Лендинг оставляет свои данные и генерируется письмо менеджеру RBKmoney 
   и заводится заявка в ZenDesk
2. Менеджер получив контакты пользователя связывается с ним и запрашивает документы по почте.
3. Менеджер регистрирует пользователя через Dashboard - заполняет данные и создавая магазин
4. Менеджер в PAPI заполняет недостающие поля - категория магазина, шаблон контракта, данные о договоре
5. Менеджер принимает заявку и магазин активируется.
6. Менеджер сбрасывает пароль через PAPI и пользователю приход оповещение на почту (в теории должно быть кастомное письмо) 